<!DOCTYPE html>
<meta charset="UTF-8">
<html lang="en">
<head>
  <title>A JavaScript project</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  <!-- <link href="https://unpkg.com/tabulator-tables@5.0.7/dist/css/tabulator.min.css" rel="stylesheet"> -->

  <link rel="stylesheet" href="style.css">

  <style>
    .node rect {
        stroke-width: 3px;
    }

    .node text {
        font: 12px sans-serif;
        fill: #fff;
    }

    .link {
        fill: none;
        stroke: #ccc;
        stroke-width: 2px;
    }

  </style>
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>


<body>

  <div class="container">
    <div class="row">
      <div class="col">

      </div>
      <div class="col-10">
        <div class="row"></div>
        <h1>Proof of Liability</h1>
        </div>
        <div class="row">
          <div class="nav nav-tabs nav-fill" id="nav-tab" role="tablist">
            <button class="nav-link active" id="nav-data-tab" data-bs-toggle="tab" data-bs-target="#nav-data" type="button" role="tab" aria-controls="nav-data" aria-selected="true">Load Data</button>
            <button class="nav-link" id="nav-tree-tab" data-bs-toggle="tab" data-bs-target="#nav-tree" type="button" role="tab" aria-controls="nav-tree" aria-selected="false">Build Tree</button>
            <button class="nav-link" id="nav-verify-tab" data-bs-toggle="tab" data-bs-target="#nav-verify" type="button" role="tab" aria-controls="nav-verify" aria-selected="false">Verify Audit</button>
          </div>
        </div>
        <div class="row">
          <div class="tab-content" id="nav-tabContent">
            <div class="tab-pane fade show active" id="nav-data" role="tabpanel" aria-labelledby="nav-data-tab">
              <div class="row"><h2>Insert Data</h2></div>
              <div class="row"><div id="users-table"></div></div></div>
            <div class="tab-pane fade" id="nav-tree" role="tabpanel" aria-labelledby="nav-tree-tab"><graph></graph></div>
            <div class="tab-pane fade" id="nav-verify" role="tabpanel" aria-labelledby="nav-verify-tab">Verify auth path</div>
          </div>
      </div>
      </div>
      <div class="col">

      </div>
    </div>
  </div>



  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
  <script src = "https://d3js.org/d3.v4.min.js"></script>
  <!-- <script type="text/javascript" src="https://unpkg.com/tabulator-tables@5.0.7/dist/js/tabulator.min.js"></script> -->

  <script>

      // var tabledata = [
      //     {id:1, name:"Oli Bob", progress:12, gender:"male", rating:1, col:"red", dob:"19/02/1984", car:1},
      //     {id:2, name:"Mary May", progress:1, gender:"female", rating:2, col:"blue", dob:"14/05/1982", car:true},
      //     {id:3, name:"Christine Lobowski", progress:42, gender:"female", rating:0, col:"green", dob:"22/05/1982", car:"true"},
      //     {id:4, name:"Brendon Philips", progress:100, gender:"male", rating:1, col:"orange", dob:"01/08/1980"},
      //     {id:5, name:"Margret Marmajuke", progress:16, gender:"female", rating:5, col:"yellow", dob:"31/01/1999"},
      //     {id:6, name:"Frank Harbours", progress:38, gender:"male", rating:4, col:"red", dob:"12/05/1966", car:1},
      // ];


      // var table = new Tabulator("#users-table", {
      //     data:tabledata,           //load row data from array
      //     layout:"fitColumns",      //fit columns to width of table
      //     responsiveLayout:"hide",  //hide columns that dont fit on the table
      //     tooltips:true,            //show tool tips on cells
      //     addRowPos:"top",          //when adding a new row, add it to the top of the table
      //     history:true,             //allow undo and redo actions on the table
      //     pagination:"local",       //paginate the data
      //     paginationSize:7,         //allow 7 rows per page of data
      //     movableColumns:true,      //allow column order to be changed
      //     resizableRows:true,       //allow row order to be changed
      //     initialSort:[             //set the initial sort order of the data
      //         {column:"name", dir:"asc"},
      //     ],
      //     columns:[                 //define the table columns
      //         {title:"Name", field:"name", editor:"input"},
      //         {title:"Task Progress", field:"progress", hozAlign:"left", formatter:"progress", editor:true},
      //         {title:"Gender", field:"gender", width:95, editor:"select", editorParams:{values:["male", "female"]}},
      //         {title:"Rating", field:"rating", formatter:"star", hozAlign:"center", width:100, editor:true},
      //         {title:"Color", field:"col", width:130, editor:"input"},
      //         {title:"Date Of Birth", field:"dob", width:130, sorter:"date", hozAlign:"center"},
      //         {title:"Driver", field:"car", width:90,  hozAlign:"center", formatter:"tickCross", sorter:"boolean", editor:true},
      //     ],
      // });

    var treeData =
      {
        "name": "NODE NAME 1",  
        "subname": "CODE N1",    
        "fill":"orange",
        "children": [
          { 
            "name": "NODE NAME 2.1",
            "subname": "CODE N1",    
            "fill":"blue"
          },
          { "name": "NODE NAME 2.2","subname": "CODE N1"  ,"fill":"blue" },
          { "name": "NODE NAME 2.3","subname": "CODE N1","fill":"blue",
          "children": [
              { "name": "NODE NAME 3.3","fill":"blue","subname": "CODE N1",
               "children": [{
                   "name":"NODE NAME 4.1","subname": "CODE N1",
                   "fill":"#d281d2"
               }
                   ] },
              { "name": "NODE NAME 3.4","fill":"blue", "subname": "CODE N1" ,
               "children": [{
                   "name":"NODE NAME 4.2", "subname": "CODE N1" ,
                   "fill":"#d281d2"
               }
                   ]
               }
            ]
            }
        ]
      };
    
    // Set the dimensions and margins of the diagram
    var margin = {top: 20, right: 90, bottom: 30, left: 90},
        width = 960 - margin.left - margin.right,
        height = 500 - margin.top - margin.bottom;
    
    // append the svg object to the body of the page
    // appends a 'group' element to 'svg'
    // moves the 'group' element to the top left margin
    var svg = d3.select("graph").append("svg")
        .attr("width", width + margin.right + margin.left)
        .attr("height", height + margin.top + margin.bottom)
      .append("g")
        .attr("transform", "translate("
              + margin.left + "," + margin.top + ")");
    
    var i = 0,
        duration = 750,
        root;
    
    // declares a tree layout and assigns the size
    var treemap = d3.tree().size([height, width]);
    
    // Assigns parent, children, height, depth
    root = d3.hierarchy(treeData, function(d) { return d.children; });
    root.x0 = height / 2;
    root.y0 = 0;
    
    // Collapse after the second level
    root.children.forEach(collapse);
    
    update(root);
    
    // Collapse the node and all it's children
    function collapse(d) {
      if(d.children) {
        d._children = d.children
        d._children.forEach(collapse)
        d.children = null
      }
    }
    
    function update(source) {
    
      // Assigns the x and y position for the nodes
      var treeData = treemap(root);
    
      // Compute the new tree layout.
      var nodes = treeData.descendants(),
          links = treeData.descendants().slice(1);
    
      // Normalize for fixed-depth.
      nodes.forEach(function(d){ d.y = d.depth * 180});
    
      // ****************** Nodes section ***************************
    
      // Update the nodes...
      var node = svg.selectAll('g.node')
          .data(nodes, function(d) {return d.id || (d.id = ++i); });
    
      // Enter any new modes at the parent's previous position.
      var nodeEnter = node.enter().append('g')
          .attr('class', 'node')
          .attr("transform", function(d) {
            return "translate(" + source.y0 + "," + source.x0 + ")";
        })
        .on('click', click);
    
        var rectHeight = 60, rectWidth = 120;
        
        nodeEnter.append('rect')
          .attr('class', 'node')
          .attr("width", rectWidth)
          .attr("height", rectHeight)
          .attr("x", 0)
          .attr("y", (rectHeight/2)*-1)
          .attr("rx","5")
          .style("fill", function(d) {
              return d.data.fill;
          });
    
      // Add labels for the nodes
      nodeEnter.append('text')
          .attr("dy", "-.35em")
          .attr("x", function(d) {
            return 13;
          })
          .attr("text-anchor", function(d) {
            return "start";
          })
          .text(function(d) { return d.data.name; })
          .append("tspan")
          .attr("dy", "1.75em")
          .attr("x", function(d) {
            return 13;
          })
          .text(function(d) { return d.data.subname; });
    
      // UPDATE
      var nodeUpdate = nodeEnter.merge(node);
    
      // Transition to the proper position for the node
      nodeUpdate.transition()
        .duration(duration)
        .attr("transform", function(d) { 
            return "translate(" + d.y + "," + d.x + ")";
         });
    
      // Update the node attributes and style
      nodeUpdate.select('circle.node')
        .attr('r', 10)
        .style("fill", function(d) {
            return d._children ? "lightsteelblue" : "#fff";
        })
        .attr('cursor', 'pointer');
    
    
      // Remove any exiting nodes
      var nodeExit = node.exit().transition()
          .duration(duration)
          .attr("transform", function(d) {
              return "translate(" + source.y + "," + source.x + ")";
          })
          .remove();
    
      // On exit reduce the node circles size to 0
      nodeExit.select('circle')
        .attr('r', 1e-6);
    
      // On exit reduce the opacity of text labels
      nodeExit.select('text')
        .style('fill-opacity', 1e-6);
    
      // ****************** links section ***************************
    
      // Update the links...
      var link = svg.selectAll('path.link')
          .data(links, function(d) { return d.id; });
    
      // Enter any new links at the parent's previous position.
      var linkEnter = link.enter().insert('path', "g")
          .attr("class", "link")
          .attr('d', function(d){
            var o = {x: source.x0, y: source.y0}
            return diagonal(o, o)
          });
    
      // UPDATE
      var linkUpdate = linkEnter.merge(link);
    
      // Transition back to the parent element position
      linkUpdate.transition()
          .duration(duration)
          .attr('d', function(d){ return diagonal(d, d.parent) });
    
      // Remove any exiting links
      var linkExit = link.exit().transition()
          .duration(duration)
          .attr('d', function(d) {
            var o = {x: source.x, y: source.y}
            return diagonal(o, o)
          })
          .remove();
    
      // Store the old positions for transition.
      nodes.forEach(function(d){
        d.x0 = d.x;
        d.y0 = d.y;
      });
    
      // Creates a curved (diagonal) path from parent to the child nodes
      function diagonal(s, d) {
    
        path = `M ${s.y} ${s.x}
                C ${(s.y + d.y) / 2} ${s.x},
                  ${(s.y + d.y) / 2} ${d.x},
                  ${d.y} ${d.x}`
    
        return path
      }
    
      // Toggle children on click.
      function click(d) {
        if (d.children) {
            d._children = d.children;
            d.children = null;
          } else {
            d.children = d._children;
            d._children = null;
          }
        update(d);
      }
    }
    
    </script>
  </body>
</html>